WITH 

year_lower_bound AS (SELECT 2019 AS value),
year_upper_bound AS (SELECT 2022 AS value),

unique_intender_data AS (
    SELECT 
    calendar_date,
    guid
    FROM spectrum_comscore.clickstream_ca
    WHERE (date_part(year, calendar_date) >= (SELECT value FROM year_lower_bound) AND date_part(year, calendar_date) <= (SELECT value FROM year_upper_bound)) AND
    ((domain LIKE 'petland.c%')
    OR (domain LIKE '%petvalu.c%')
    OR (domain LIKE '%petsmart.c%')
    OR (domain LIKE '%baileyblu.com%')
    OR (domain LIKE 'chico.c%' OR domain LIKE '%boutiquedanimauxchico.com%')
    OR (domain LIKE 'mondou.c%')
    OR (domain LIKE '%pattesgriffes.com%')
    OR (domain LIKE '%tailblazerspets.com%')
    OR (domain LIKE 'wbu.c%') OR
    (domain LIKE '%canadiantire.ca%' AND (event_detail LIKE '%animalerie%' OR event_detail LIKE '%pet-care%')) OR
    (domain LIKE '%walmart.ca%' AND (event_detail LIKE '%animalerie%' OR event_detail LIKE '%animaux%' OR event_detail LIKE '%pets%' OR event_detail LIKE '%pet-%' OR event_detail LIKE '%pet/%' OR event_detail LIKE '%pet\.%')) OR
    ((domain LIKE '%amazon%' OR domain LIKE '%amzn%') AND (event_detail LIKE '%animalerie%' OR event_detail LIKE '%animaux%' OR event_detail LIKE '%pets%' OR event_detail LIKE '%pet-%' OR event_detail LIKE '%pet/%' OR event_detail LIKE '%pet\.%')) OR
    (domain LIKE '%costco.ca%' AND (event_detail LIKE '%animalerie%' OR event_detail LIKE '%animaux%' OR event_detail LIKE '%pets%' OR event_detail LIKE '%pet-%' OR event_detail LIKE '%pet/%' OR event_detail LIKE '%pet\.%')) OR
    (domain LIKE '%sobeys.com%' AND (event_detail LIKE '%animalerie%' OR event_detail LIKE '%pet%')))
),

-- *********************************************************************************************
--  MAIN TABLES
-- *********************************************************************************************

total_intenders AS (
    SELECT
        date_part(year, calendar_date) AS join_field_a,
        date_part(month, calendar_date) AS join_field_b,
        COUNT(DISTINCT guid) AS unique_users
    FROM unique_intender_data
    GROUP BY 1, 2
),

total_converters AS (
    SELECT
        date_part(year, calendar_date) AS join_field_a,
        date_part(month, calendar_date) AS join_field_b,
        COUNT(DISTINCT guid) AS unique_users
    FROM unique_intender_data WHERE guid IN (
        '502570034',
        '492572801',
        '507373529',
        '508062480',
        '501510420',
        '256172422',
        '436033496',
        '501730737',
        '413105875',
        '494504274',
        '320297240',
        '493640474',
        '496007163',
        '278487585',
        '509744145',
        '496604410',
        '532530649',
        '484070647',
        '509543974',
        '478001117',
        '522015788',
        '448856563',
        '508676913',
        '507054043',
        '504612114',
        '506710126',
        '492639784',
        '493501510',
        '522548489',
        '501051274',
        '477133363',
        '491638264',
        '499681169',
        '492541012',
        '356874286',
        '499166217',
        '277123474',
        '508202101',
        '502021432',
        '512506876',
        '464501756',
        '499762166',
        '500631138',
        '498527680',
        '517078677',
        '446213346',
        '501618202',
        '326367867',
        '503550987',
        '512707363',
        '535014925',
        '499067276',
        '479235364',
        '493061264',
        '498082094',
        '336572290',
        '503141234',
        '517155794',
        '318008952',
        '478250169',
        '505708446',
        '496027387',
        '532063682',
        '510141512',
        '502673488',
        '504255419',
        '499046445',
        '501597472',
        '496711525',
        '351149798',
        '494096107',
        '476749173',
        '477170699',
        '501500272',
        '317942049',
        '493135492',
        '499515228',
        '500197339',
        '482538579',
        '531508305',
        '510502984',
        '501674832',
        '498676124',
        '137507918',
        '453705123',
        '489614782',
        '504085677',
        '505060160',
        '541071504',
        '509739391',
        '489190312',
        '487178235',
        '314611542',
        '521501935',
        '451564362',
        '492141015',
        '510090359',
        '505095585',
        '478519239',
        '462134109',
        '535525045',
        '498643135',
        '478626139',
        '506664357',
        '496017891',
        '496616507',
        '502185067',
        '496135141',
        '557549668',
        '499061216',
        '499077870',
        '496683757',
        '476535497',
        '355592291',
        '499504458',
        '508584601',
        '470850467',
        '509087222',
        '469872251',
        '487534548',
        '500000602',
        '138057811',
        '500164037',
        '503025496',
        '387592668',
        '498159495',
        '479033972',
        '482789458',
        '351972588',
        '502684116',
        '482556294',
        '501658836',
        '489120241',
        '490754522',
        '304071061',
        '499139861',
        '502698121',
        '492077990',
        '137341600',
        '312559645',
        '500625811',
        '504552158',
        '525057753',
        '505529236',
        '461046650',
        '278661008',
        '134350387',
        '460519132',
        '355480824',
        '509162598',
        '503577098',
        '502508819',
        '509216174',
        '490754521',
        '492619738',
        '486598645',
        '448620027',
        '298230379',
        '508258455',
        '508534911',
        '136557987',
        '506098037',
        '353999307',
        '486675551',
        '382100072',
        '502505281',
        '483204847',
        '498525598',
        '473162358',
        '476277238',
        '349173732',
        '464162601',
        '354565666',
        '510561697',
        '359006800',
        '483123688',
        '320822123',
        '238503148',
        '339283736',
        '501142214',
        '457055662',
        '517588639',
        '501771976',
        '389035820',
        '289569874',
        '508321274',
        '269315631',
        '505685437',
        '505701619',
        '496075284',
        '509026346',
        '477645809',
        '437531005',
        '482749944',
        '341406463',
        '494521783',
        '469125426',
        '253420828',
        '505574984',
        '502154604',
        '510648337',
        '523087219',
        '480204814',
        '481254097',
        '355525268',
        '307360552',
        '514560183',
        '503178433',
        '340898957',
        '499556362',
        '137159722',
        '479107087',
        '492157835',
        '504212368',
        '283638402',
        '523587774',
        '347766780',
        '137027261',
        '508212092',
        '499185317',
        '553511075',
        '395632377',
        '486532320',
        '137376276',
        '517529911',
        '503001053',
        '499227699',
        '458651964',
        '487049914',
        '499668234',
        '309725791',
        '460026650',
        '138085971',
        '463388184',
        '417537134',
        '487043688',
        '506630148',
        '322753604',
        '489570548',
        '501632735',
        '512001940',
        '484113315',
        '354112345',
        '507247028',
        '501550190',
        '349286675',
        '486529591',
        '455329609',
        '477231194',
        '511282111',
        '550086721',
        '517501773',
        '508170008',
        '492779001',
        '502685827',
        '466245191',
        '502228261',
        '485518199',
        '501142103',
        '494565275',
        '506106494',
        '502502170',
        '504586624',
        '492200194',
        '514605111',
        '517596351',
        '499061401',
        '500589700',
        '452230024',
        '505225735',
        '506569932',
        '484033432',
        '504237780',
        '506156558',
        '136868101',
        '506182674',
        '487094358',
        '515033194',
        '505022872',
        '504207071',
        '504047128',
        '499724002',
        '505750344',
        '505611553',
        '513107320',
        '502771170',
        '503592044',
        '503554316',
        '500558820',
        '486597684',
        '442660143',
        '519592610',
        '480560593',
        '497593408',
        '476152211',
        '477610284',
        '412070766',
        '482085749',
        '493517120',
        '480561282',
        '504607908',
        '529540835',
        '487018020',
        '352523163',
        '530042842',
        '450788515',
        '488528658',
        '504572919',
        '253094051',
        '478199105',
        '136656745',
        '513057081',
        '469020926',
        '518594632',
        '530085121',
        '479224913',
        '417047544',
        '465594793',
        '487650217',
        '515088644',
        '353232411',
        '506504680',
        '526545074',
        '558021252',
        '483690602',
        '253102395',
        '285012226',
        '488153115',
        '491140269',
        '502211032',
        '471819065',
        '276641588',
        '511515003',
        '509543958',
        '353365106',
        '353462666',
        '512159872',
        '386614398',
        '512138297',
        '332936455',
        '505617485',
        '493547536',
        '361287770',
        '445703630',
        '494637111',
        '355612303',
        '307195051',
        '490011621',
        '464556512',
        '498222849',
        '493227756',
        '247627260',
        '442234218',
        '482102996',
        '514658902',
        '496232540',
        '485030875',
        '390132278',
        '484619448',
        '526588961',
        '362564198',
        '509656792',
        '280887045',
        '477758478',
        '476702843',
        '332732758',
        '361939790',
        '503126757',
        '509098275',
        '299706668',
        '498643915',
        '513771134',
        '501778192',
        '512631423',
        '520087104',
        '504730738',
        '470362552',
        '508188366',
        '492652062',
        '513627128',
        '476602120',
        '354438724',
        '283798283',
        '492092946',
        '512725633',
        '477629642',
        '536033487',
        '501548780',
        '517083009',
        '497236554',
        '493338549',
        '452208705',
        '504220468',
        '510137816',
        '509166871',
        '512070212',
        '513122888',
        '502791724',
        '480561915',
        '504666724',
        '504273251',
        '512535409',
        '281706106',
        '486695043',
        '512700515',
        '509710570',
        '353338531',
        '498629262',
        '506574739',
        '504252797',
        '486673755',
        '485617867',
        '510556508',
        '491144899',
        '502763470',
        '492682010',
        '268589119',
        '488082405',
        '495093269',
        '505100692',
        '504744304',
        '485544314',
        '476157845',
        '468433812',
        '489233146',
        '510582046',
        '424616877',
        '485019455',
        '489635415',
        '525538291',
        '499507810',
        '492618207',
        '302731642',
        '507388874',
        '486610279',
        '498226845',
        '464097000',
        '497571761',
        '344514003',
        '520544764',
        '495724376',
        '514079039',
        '273864410',
        '506520290',
        '272840660',
        '476248336',
        '508322177',
        '511767638',
        '510622832',
        '503022600',
        '261830072',
        '489630954',
        '478029230',
        '522088299',
        '491065158',
        '492509158',
        '522575105',
        '474162404',
        '364235231',
        '511658186',
        '353907544',
        '356048479',
        '503542574',
        '501597804',
        '237335004',
        '493593080',
        '478057118',
        '511050148',
        '508571444',
        '517088480',
        '501602241',
        '513023822',
        '489659998',
        '498643916',
        '505681861',
        '351862518',
        '514158392',
        '493278299',
        '489582513',
        '490691800',
        '353098016',
        '340715796',
        '480005833',
        '499541589',
        '512089539',
        '496558085',
        '502547013',
        '503133153',
        '502660389',
        '500114503',
        '529565648',
        '510062420',
        '261394017',
        '498602848',
        '516583023',
        '491698780',
        '499560124',
        '461732618',
        '481607751',
        '506521441',
        '522030701',
        '505045579',
        '463191713',
        '504252798',
        '504506496',
        '499066633',
        '511266510',
        '349007252',
        '511005013',
        '499265408',
        '512634754',
        '527502909',
        '482645771',
        '505577660',
        '504588430',
        '501608121',
        '508135864',
        '505665055',
        '489089957',
        '527079445',
        '509715592',
        '494557861',
        '466671265',
        '494529539',
        '501503723',
        '506611338',
        '351960324',
        '515621513',
        '505022310',
        '479154547',
        '499769036',
        '506000647',
        '488142010',
        '486532531',
        '256856510',
        '299028639',
        '491552475',
        '502194762',
        '491194906',
        '536090210',
        '506093563',
        '503639894',
        '353093563',
        '512111739',
        '510560363',
        '499159666',
        '511646695',
        '339137578',
        '474542144',
        '498557766',
        '483792618',
        '506180043',
        '513602459',
        '479501340',
        '529522729',
        '500555551',
        '496544694',
        '517169378',
        '504237781',
        '499274646',
        '500692349',
        '502775466',
        '512555236',
        '328870163',
        '533549796',
        '510636965',
        '490517691',
        '440064033',
        '505645270',
        '498678606',
        '502140198',
        '509618891',
        '455019007',
        '493309047',
        '475649728',
        '500538698',
        '341843422',
        '475533585',
        '509588395',
        '494026259',
        '346097189',
        '508271957',
        '498059764',
        '485600841',
        '137161234',
        '136094255',
        '497518768',
        '503679450',
        '492673657',
        '351669201',
        '135104211',
        '520064084',
        '476558071',
        '491134233',
        '461192315',
        '504028591',
        '521106525',
        '382159088',
        '503195763',
        '478179002',
        '527080024',
        '454671581',
        '483228769',
        '362872626',
        '504500278',
        '536060844',
        '503136454',
        '501554428',
        '503630198',
        '504094499',
        '492664886',
        '502697846',
        '504710596',
        '501025559',
        '504679203',
        '262924512',
        '479708614',
        '501022204',
        '516026214',
        '505681108',
        '504704265',
        '509633563',
        '465260916',
        '281635733',
        '500041439',
        '536021694',
        '275320060',
        '492649845',
        '495107166',
        '299480697',
        '494123899',
        '509683597',
        '483236643',
        '499130392',
        '477230480',
        '509618189',
        '137351880',
        '497131416',
        '503674259',
        '518612018',
        '484788067',
        '486677766',
        '524596977',
        '366715063',
        '436211873',
        '505002355',
        '502702777',
        '502711415',
        '136170542',
        '476694070',
        '344303846',
        '479060862',
        '360762690',
        '463457329',
        '490241178',
        '450732897',
        '486634396',
        '501596932',
        '501030563',
        '358985627',
        '503570653',
        '279313463',
        '237343534',
        '136944526',
        '489731736',
        '484780259',
        '492018466',
        '522535802',
        '437142218',
        '504676808',
        '515554072',
        '481239037',
        '464609087',
        '492112462',
        '505516347',
        '504023912',
        '512142491',
        '505218880',
        '528068795',
        '502565518',
        '492705656',
        '519568247',
        '499137632',
        '517090243',
        '442054062',
        '509624491',
        '505196374',
        '285240415',
        '488515751',
        '489563359',
        '492649847',
        '511603820',
        '485097617',
        '416711668',
        '477189780',
        '497585096',
        '511660662',
        '238722210',
        '491003809',
        '504645936',
        '501010910',
        '461723250',
        '504614094',
        '366804195',
        '483727741',
        '538025625',
        '511756988',
        '494714883',
        '504613879',
        '526019455',
        '358387569',
        '470880366',
        '500553772',
        '138277977',
        '506078706',
        '493716901',
        '479100134',
        '505631383',
        '493111628',
        '331176382',
        '359227708',
        '510624821',
        '521569620',
        '530049329',
        '511649255',
        '499698464',
        '434028551',
        '509144326',
        '503030951',
        '505113561',
        '462010747',
        '461122344',
        '368593868',
        '499616690',
        '479195269',
        '417803527',
        '478224264',
        '538580585',
        '482046569',
        '514520341',
        '509693591',
        '512736154',
        '506101936',
        '500091925',
        '524593533',
        '503775430',
        '501068170',
        '463599233',
        '508618588',
        '550531261',
        '513563801',
        '511067431',
        '503762718',
        '509114325',
        '535029593',
        '490012751',
        '503166576',
        '459076001',
        '501652275',
        '502127326',
        '499198810',
        '501019643',
        '489735267',
        '500195375',
        '504641574',
        '487195565',
        '504035340',
        '510070582',
        '477630753',
        '352672961',
        '515150369',
        '490109453',
        '502583929',
        '505179244',
        '313004322',
        '317100403',
        '501196861',
        '501533942',
        '549001111',
        '367865613',
        '363202094',
        '507192961',
        '488215102',
        '517137388',
        '511702043',
        '453689315',
        '509675846',
        '499066632',
        '285671659',
        '492509000',
        '352864989',
        '511744546',
        '482030878',
        '508576628',
        '511668367',
        '498053829',
        '501217184',
        '460168449',
        '508509971',
        '490691799',
        '488069560',
        '481155521',
        '500593851',
        '509504843',
        '512639988',
        '530000131',
        '549553819',
        '493711156',
        '502694282',
        '505500132',
        '505503993',
        '480688386',
        '501187527',
        '416677170',
        '273184524',
        '477209687',
        '511578242',
        '481508321',
        '510082418',
        '508167067',
        '513209846',
        '500666985',
        '501505960',
        '506697590',
        '344504566',
        '509248885',
        '237885546',
        '506502672',
        '511593487',
        '486651954',
        '433228676',
        '328346785',
        '512602090',
        '485636126',
        '519114821',
        '271499878',
        '314480598',
        '514086056',
        '341523052',
        '505720858',
        '491191893',
        '490230115',
        '487628713',
        '478661522',
        '500172951',
        '504001694',
        '508618786',
        '354690103',
        '481734273',
        '408739238',
        '360444077',
        '498603445',
        '518114078',
        '502230527',
        '523587775',
        '464298448',
        '388160124',
        '502108367',
        '466018377',
        '494646276',
        '515606020',
        '489031725',
        '358561620',
        '510114562',
        '474052565',
        '510040898',
        '490613488',
        '500679392',
        '483040064',
        '522100813',
        '486542854',
        '345884674',
        '500621080',
        '503706295',
        '486187866',
        '508615383',
        '498699418',
        '460125798',
        '456168867',
        '464270367',
        '504742974',
        '481123282',
        '486042199',
        '505205422',
        '316385859',
        '502256931',
        '482650539',
        '509029981',
        '368695295',
        '361939813',
        '509168192',
        '468772913',
        '418757693',
        '314196551',
        '511646697',
        '448559851',
        '353724554',
        '554527068',
        '499680936',
        '506694792',
        '356498452',
        '513060093',
        '489056240',
        '428147511',
        '352317232',
        '505643426',
        '525058445',
        '479772744',
        '503118967',
        '493732066',
        '359807760',
        '526067890',
        '300906688',
        '265153602',
        '493178984',
        '474594744',
        '508552168',
        '481194763',
        '471021994',
        '512028917',
        '476742424',
        '441252301',
        '362016763',
        '319582176',
        '497045572',
        '518027396',
        '508170010',
        '508611525',
        '504658904',
        '360274073',
        '504182052',
        '355360011',
        '548029689',
        '280399834',
        '333050735',
        '283371437',
        '524067561',
        '513216331',
        '285728628',
        '319043144',
        '501674836',
        '505715974',
        '337074561',
        '499665855',
        '485045286',
        '265179298',
        '511051046',
        '509711892',
        '486621700',
        '484532184',
        '344866048',
        '350057140',
        '313095006',
        '507244411',
        '352168993',
        '348560433',
        '524023441',
        '353234695',
        '270254419',
        '308721002',
        '349031643',
        '347235495',
        '504113166',
        '506078487',
        '501145323',
        '486514869',
        '493651633',
        '297063504',
        '512036666',
        '251625863',
        '526503760',
        '265370700',
        '362599833',
        '485617028',
        '478243776',
        '505674368',
        '501806836',
        '508348244',
        '342506645',
        '245680321',
        '506104920',
        '355475286',
        '505147405',
        '494037570',
        '330973436',
        '355526142',
        '505140357',
        '522043121',
        '412576659',
        '505164537',
        '538020151',
        '511142167',
        '359302733',
        '349702950',
        '518120408',
        '344565191',
        '410161177',
        '486182036',
        '472006496',
        '462520543',
        '466638594',
        '507560905',
        '502632956',
        '348556309',
        '237873372',
        '345021585',
        '322881265',
        '347048338',
        '509542138',
        '449086108',
        '501627537',
        '359394669',
        '273662804',
        '505228997',
        '401637882',
        '506169141',
        '511141452',
        '470745768',
        '285726222',
        '470391610',
        '508549259',
        '262166200',
        '508348243',
        '348783762',
        '485167807',
        '508544645',
        '345489962',
        '274037097',
        '508131968',
        '510638453',
        '361678705',
        '499138134',
        '515042846',
        '350834692',
        '479034512',
        '489603123',
        '354679183',
        '433196080',
        '493559761',
        '344369748',
        '507280208',
        '523003112',
        '337391244',
        '324455581',
        '512653071',
        '510084996',
        '251448593',
        '353983423',
        '451608518',
        '477202587',
        '356930312',
        '272981917',
        '438509707',
        '492575975',
        '504724929',
        '505573356',
        '476641683',
        '503186759',
        '478225569',
        '353178038',
        '360762513',
        '238494112',
        '504065870',
        '347190923',
        '442801957',
        '495142410',
        '481751404',
        '367894146',
        '510518112',
        '499076357',
        '491114596',
        '287292150',
        '492698143',
        '505172518',
        '505701191',
        '482143114',
        '511235983',
        '359313994',
        '285095682',
        '248952095',
        '511135364',
        '500546255',
        '508024506',
        '275487127',
        '499176514',
        '507100741',
        '268907819',
        '356093063',
        '353706374',
        '484196451',
        '356018976',
        '510148049',
        '516026215',
        '353664673',
        '496160687',
        '474591021',
        '511032078',
        '347045250',
        '356423813',
        '137818692',
        '518618691',
        '473194434',
        '434606024',
        '500669498',
        '353427267',
        '505150955',
        '504556615',
        '430853019',
        '138078192',
        '501594508',
        '353174904',
        '506687443',
        '136013703',
        '501802978',
        '516066210',
        '273994215',
        '501632798',
        '497260325',
        '497138148',
        '523563043',
        '355603700',
        '356461538',
        '498500950',
        '263201787',
        '345175644',
        '507316801',
        '506235954',
        '282360495',
        '354006263',
        '499749726',
        '501227072',
        '488630432',
        '524061043',
        '505139951',
        '353212172',
        '492088771',
        '507054402',
        '502733395',
        '511540510',
        '488740686',
        '450277597',
        '412300437',
        '497647182',
        '355801188',
        '349547298',
        '511086460',
        '505713789',
        '501107867',
        '506235955',
        '501513971',
        '512579088',
        '499245009',
        '481638270',
        '511624254',
        '512559561',
        '344968460',
        '511244551',
        '499241462',
        '506015872',
        '538580971',
        '501165823',
        '478690859',
        '529008948',
        '509147259',
        '502697845',
        '516591884',
        '454640075',
        '488666322',
        '274960442',
        '500097681',
        '510141171',
        '486621540',
        '501115761',
        '494003652',
        '494624104',
        '443646469',
        '505209110',
        '506020188',
        '261747415',
        '536526814',
        '499078707',
        '490583575',
        '254765612',
        '497206534',
        '500680807',
        '502634059',
        '494541295',
        '339302326',
        '520020213',
        '319116074',
        '446804798',
        '506025994',
        '515026961',
        '357045897',
        '494204401',
        '518069821',
        '492192208',
        '512034616',
        '507505452',
        '510067384',
        '474052564',
        '505568602',
        '501083876',
        '437520839',
        '349038639',
        '504171828',
        '502183597',
        '279945409',
        '502754622',
        '486713919',
        '498555764',
        '510569844',
        '506062726',
        '496570746',
        '272613254',
        '506696266',
        '527007224',
        '502634061',
        '334378712',
        '353588191',
        '525090977',
        '501729331',
        '527525982',
        '500023497',
        '490122097',
        '480703899',
        '524523055',
        '479112286',
        '502212501',
        '512732715',
        '315063045',
        '479732351',
        '511210890',
        '522562565',
        '500112934',
        '503616956',
        '502237479',
        '499050396',
        '500628206',
        '499011317',
        '504623800',
        '514085496',
        '480018463',
        '513172159',
        '452077536',
        '423685783',
        '515084813',
        '497019114',
        '501136829',
        '136960932',
        '499140761',
        '476528030',
        '339200777',
        '510606489',
        '486017745',
        '350418140',
        '251013140',
        '494064024',
        '312757168',
        '508517662',
        '504163800',
        '289004917',
        '281580341',
        '500229514',
        '507434517',
        '330453123',
        '501105864',
        '480612241',
        '290908765',
        '488521842',
        '298629713',
        '488059546',
        '347394206',
        '481544696',
        '360860240',
        '496744165',
        '250033345',
        '347764379',
        '504061507',
        '486017746',
        '498530749',
        '281368600',
        '362762797',
        '355339677',
        '337969199',
        '258608450',
        '494175724',
        '331586476',
        '346690030',
        '333248247',
        '381667196',
        '484768885',
        '491617812',
        '342580090',
        '502503470',
        '474672524',
        '303990604',
        '493647722',
        '494094464',
        '505072324',
        '295365569',
        '504019381',
        '136712789',
        '363299646',
        '508090871',
        '499131695',
        '505550336',
        '296920224',
        '496718400',
        '494204194',
        '488038607',
        '512059507',
        '297009170',
        '255561895',
        '321723468',
        '495065152',
        '470032129',
        '503730375',
        '504562558',
        '502507128',
        '474687475',
        '525533877',
        '507034274',
        '503138677',
        '279373111',
        '500015945',
        '360190652',
        '355744600',
        '339277377',
        '504018734',
        '374581297',
        '524039082',
        '282817974',
        '297052459',
        '349936193',
        '500212572',
        '508132511',
        '507468083',
        '511179596',
        '507197131',
        '324746700',
        '503599020',
        '506514874',
        '472670229',
        '536050274',
        '502056898',
        '481681889',
        '496151843',
        '328146630',
        '407690436',
        '500176590',
        '504130539',
        '497670279',
        '487585572',
        '495007513',
        '137307743',
        '493521645',
        '530085120',
        '491557462',
        '333597272',
        '317572788',
        '512648069',
        '438773512',
        '498118501',
        '482651406',
        '503509815',
        '359539444',
        '555593168',
        '508669478',
        '361940554',
        '357386406',
        '501114913',
        '502703215',
        '510526175',
        '345715165',
        '503549062',
        '528512125',
        '480145643',
        '339632712',
        '399717750',
        '347811415',
        '351024297',
        '496606521',
        '277841649',
        '479687858',
        '498181795',
        '498589339',
        '422027274',
        '332967563',
        '490174549',
        '480146198',
        '509061665',
        '341470450',
        '497520150',
        '505605732',
        '138358393',
        '275764853',
        '505003911',
        '355557618',
        '486085478',
        '358635999',
        '508132510',
        '512645702',
        '490068013',
        '506170125',
        '526506245',
        '499541806',
        '504109287',
        '248593559',
        '314812973',
        '506059142',
        '304075447',
        '511078063',
        '262789295',
        '507571449',
        '502736926',
        '481046728',
        '494701943',
        '491224287',
        '135384708',
        '340745322',
        '356718634',
        '524500198',
        '484731960',
        '365107540',
        '365301427',
        '479504437',
        '432045953',
        '475672286',
        '501251802',
        '475015837',
        '368620464',
        '381667197',
        '497258466',
        '262434795',
        '504675818',
        '350362068',
        '351182149',
        '491552383',
        '365343417',
        '518556635',
        '248927510',
        '491105868',
        '508663682',
        '349730663',
        '499191873',
        '482253399',
        '309512405',
        '135951516',
        '476077300',
        '261145158',
        '497601275',
        '423692265',
        '501597471',
        '505036919',
        '499647848',
        '484026018',
        '363472352',
        '352824930',
        '359841720',
        '476158439',
        '341147974',
        '305414191',
        '472019582',
        '262172353',
        '483274717',
        '511540317',
        '503173912',
        '267771206',
        '501251801',
        '494567756',
        '493521644',
        '425630250',
        '136954975',
        '500167401',
        '503509814',
        '492211756',
        '557575179',
        '483681517',
        '351730364',
        '501777814',
        '508168669',
        '519039037',
        '493319371',
        '484796176',
        '490143317',
        '501160247',
        '501789641',
        '485017787',
        '501253803',
        '356361697',
        '455316004',
        '491025348',
        '476578929',
        '478554335',
        '492682610',
        '486536541',
        '328225899',
        '492170542',
        '370457688',
        '470880531',
        '502750411',
        '349217899',
        '493679300',
        '340932948',
        '419558515',
        '356546679',
        '253111246',
        '507536324',
        '502036847',
        '464598574',
        '504668840',
        '446553734',
        '498636424',
        '513022108',
        '448747816',
        '521059558',
        '524588603',
        '494119945',
        '501275449',
        '556526831',
        '425302229',
        '479087909',
        '486680197',
        '368133308',
        '501515773',
        '500657738',
        '490313281',
        '502659442',
        '496121233',
        '136054263',
        '505539969',
        '349632302',
        '474529607',
        '136117785',
        '313631214',
        '305013545',
        '476544742',
        '415165009',
        '338802431',
        '517508344',
        '509207594',
        '501101420',
        '359387177',
        '476505043',
        '136622611',
        '501612066',
        '430586128',
        '528000126',
        '508676012',
        '344957844',
        '502098595',
        '493623616',
        '489003206',
        '500559997',
        '501777815',
        '370574488',
        '510039075',
        '502167751',
        '499077152',
        '485208112',
        '492622732',
        '512122993',
        '514167031',
        '497664642',
        '471614734',
        '500134198',
        '528512126',
        '359813210',
        '509196568',
        '507276680',
        '506164860',
        '426157357',
        '367190181',
        '509543959',
        '500674650',
        '136865010',
        '508049410',
        '504181084',
        '474543724',
        '364552403',
        '500517192',
        '481254970',
        '507034275',
        '283016151',
        '519501369',
        '508548407',
        '423116181',
        '490031083',
        '426728887',
        '544036004',
        '319569318',
        '476527080',
        '496083562',
        '498107880',
        '136868549',
        '493199366',
        '500091995',
        '500596304',
        '477660282',
        '485022316',
        '134276522',
        '492660594',
        '504597485',
        '410161178',
        '501674837',
        '481714570',
        '504116178',
        '502022167',
        '506137225',
        '520581608',
        '481544697',
        '136647038',
        '511652404',
        '510546659',
        '136748430',
        '501757876',
        '440707545',
        '501830225',
        '524500199',
        '135686587',
        '503623117',
        '501614195',
        '499020247',
        '465000456',
        '506508173',
        '483503255',
        '482710736',
        '518031293',
        '502225018',
        '483019530',
        '499699616',
        '505133410',
        '353067604',
        '502116600',
        '511599420',
        '138044577',
        '492226378',
        '498576064',
        '362211257',
        '504179892',
        '368456714',
        '479706501',
        '367359276',
        '509262524',
        '136264289',
        '134181686',
        '557511001',
        '505597467',
        '499156347',
        '359007434',
        '494140869',
        '137447841',
        '338106180',
        '504148523',
        '513760295',
        '511067402',
        '475697475',
        '496218822',
        '502018653',
        '510023590',
        '492081972',
        '502696816',
        '480095609',
        '353211653',
        '515150296',
        '492002390',
        '506224864',
        '341532827',
        '479645867',
        '500547733',
        '501500570',
        '134619005',
        '499064697',
        '482038368',
        '486031915',
        '472558533',
        '356523612',
        '506002647',
        '501533907',
        '493669220',
        '483517087',
        '498604853',
        '256992158',
        '481625303',
        '472746259',
        '339067592',
        '462225262',
        '509697239',
        '497602138',
        '349254624',
        '514524869',
        '491034764',
        '506061079',
        '339540698',
        '309146051',
        '495551763',
        '499653096',
        '502789332',
        '532069417',
        '501795847',
        '504048229',
        '345952506',
        '505603026',
        '502695294',
        '504265509',
        '518565995',
        '512523061',
        '503784688',
        '136653221',
        '451658979',
        '504658979',
        '503674327',
        '478029240',
        '510550869',
        '421537576',
        '502785168',
        '503784689',
        '514529964',
        '499272032',
        '136264469',
        '520576016',
        '513718712',
        '485642120',
        '528509508',
        '453639266',
        '502252867',
        '480207194',
        '340379443',
        '317199628',
        '282868042',
        '483156447',
        '488041801',
        '503083517',
        '386021587',
        '508126736',
        '284090231',
        '510141777',
        '237349551',
        '472531681',
        '504007332',
        '475595993',
        '529590916',
        '525515721',
        '486595656',
        '361497355',
        '505537130',
        '503053996',
        '480223947',
        '513193903',
        '529559658',
        '522015900',
        '504134316',
        '376605216',
        '349285047',
        '499156019',
        '317655358',
        '346632270',
        '479515139',
        '352556765',
        '274250558',
        '488004187',
        '465603667',
        '499664575',
        '276643092',
        '502103163',
        '349618728',
        '479667564',
        '477189048',
        '340841992',
        '533063170',
        '354140363',
        '257284810',
        '533011912',
        '307856867',
        '502748265',
        '501738814',
        '510513818',
        '509508914',
        '365303269',
        '499274645',
        '501002198',
        '362253708',
        '133139341',
        '316218345',
        '434653530',
        '504148487',
        '461064106',
        '288100249',
        '480546882',
        '502086682',
        '470790019',
        '504222632',
        '482201938',
        '507005350',
        '509252260',
        '499250737',
        '268731394',
        '500552351',
        '468024499',
        '290091208',
        '499272680',
        '492624464',
        '496727347',
        '507354184',
        '502684471',
        '450614244',
        '240424765',
        '481625305',
        '519068394',
        '505051656',
        '500166227',
        '495519735',
        '328303790',
        '367432099',
        '329769083',
        '286631703',
        '355526784',
        '303158380',
        '494586083',
        '362338451',
        '503574039',
        '316744858',
        '501133616',
        '295750867',
        '437620175',
        '339815239',
        '498643959',
        '474530692',
        '500587472',
        '488134722',
        '500180863',
        '514084474',
        '480066129',
        '263830627',
        '509280897',
        '510564436',
        '332341265',
        '504592316',
        '517038844',
        '493227755',
        '505510687',
        '322950928',
        '453565302',
        '498524800',
        '507374988',
        '479208542',
        '315213543',
        '506114484',
        '295930457',
        '490272694',
        '136199111',
        '364384785',
        '506202001',
        '138439817',
        '470589919',
        '508222743',
        '501263500',
        '510513817',
        '368381582',
        '511538829',
        '481137026',
        '488009278',
        '320301674',
        '497709143',
        '506176618',
        '334603590',
        '366079482',
        '459631458',
        '498055267',
        '503661458',
        '498636466',
        '277831638',
        '503197637',
        '503054633',
        '492584337',
        '281518138',
        '493286652',
        '520507410',
        '443323345',
        '304836263',
        '502705449',
        '353107928',
        '497282569',
        '504587530',
        '334609128',
        '512617053',
        '135893691',
        '521085941',
        '260876309',
        '361546173',
        '306550931',
        '479770502',
        '522026636',
        '515057116',
        '353092578',
        '487676341',
        '350471046',
        '499135244',
        '501241643',
        '352966771',
        '507126561',
        '499037897',
        '491639119',
        '502228524',
        '297185469',
        '526003578',
        '472020848',
        '452532749',
        '496730746',
        '471639580',
        '240769362',
        '305860911',
        '497519786',
        '497700832',
        '324214266',
        '499559365',
        '308801099',
        '497519771',
        '500128745',
        '450545344',
        '510147633',
        '498641400',
        '361727039',
        '471229178',
        '498626873',
        '465732625',
        '503570348',
        '494204720',
        '399222704',
        '345938377',
        '478667285',
        '254375367',
        '500692645',
        '477207222',
        '512630490',
        '508145197',
        '343842754',
        '356046123',
        '491601292',
        '505200933',
        '510021542',
        '501545278',
        '396736901',
        '342310790',
        '516071531',
        '282755314',
        '503020247',
        '362116025',
        '505562831',
        '500696167',
        '468754498',
        '503791730',
        '347519023',
        '492696782',
        '504207296',
        '273920540',
        '520071373',
        '506657452',
        '506689149',
        '503143661',
        '317864628',
        '490540537',
        '502761435',
        '499269968',
        '340805733',
        '509507162',
        '494642644',
        '501657696',
        '502084060',
        '271014034',
        '136071846',
        '318799299',
        '492599854',
        '448165410',
        '136954243',
        '497073458',
        '492188820',
        '445239297',
        '527061941',
        '512057513',
        '356587938',
        '251447332',
        '527055626',
        '509116090',
        '363178810',
        '496559418',
        '349896108',
        '512092222',
        '501520703',
        '309528989',
        '508551866',
        '479044492',
        '509215400',
        '502012062',
        '527505092',
        '333054846',
        '479594551',
        '403031695',
        '384516759',
        '499702011',
        '248819108',
        '500656005',
        '353722461',
        '361257517',
        '478662736',
        '365818510',
        '456648045',
        '274579081',
        '320118260',
        '486703802',
        '470712100',
        '474186713',
        '459633378',
        '505534931',
        '506713137',
        '481504021',
        '355296242',
        '513721806',
        '519055040',
        '511170161',
        '288173826',
        '281366264',
        '287394056',
        '499742514',
        '326502798',
        '519502485',
        '501796302',
        '484236792',
        '367604910',
        '503139354',
        '346897357',
        '499025605',
        '477013058',
        '465154456',
        '470224595',
        '505651477',
        '496512366',
        '505535959',
        '496684306',
        '504175419',
        '478244597',
        '497021716',
        '299707584',
        '333605333',
        '287620648',
        '485189874',
        '500108929',
        '502556932',
        '530535879',
        '357101091',
        '534064383',
        '504048230',
        '403781325',
        '464545766',
        '502097453',
        '341840254',
        '315559318',
        '286256485',
        '264253955',
        '367724329',
        '357108507',
        '277757074',
        '479708635',
        '503012162',
        '457034247',
        '484764413',
        '512151932',
        '515133441',
        '359588846',
        '506546300',
        '273399802',
        '345426201',
        '335861268',
        '345435786',
        '501192472',
        '357172683',
        '443054641',
        '367226138',
        '272895034',
        '515135613',
        '477162290',
        '474506803',
        '508548421',
        '492609973',
        '529048567',
        '462144351',
        '487578871',
        '490177224',
        '356458889',
        '501159582',
        '346839985',
        '438770340',
        '416756106',
        '510132020',
        '491504510',
        '499674981',
        '363215675',
        '498032824',
        '306752523',
        '273937123',
        '408754199',
        '137908048',
        '506509045',
        '356626777',
        '490095258',
        '510564150',
        '493331047',
        '506169058',
        '504690893',
        '494206199',
        '509664339',
        '553590379',
        '350982728',
        '362784384',
        '451188329',
        '477054074',
        '510664243',
        '515128751',
        '472687665',
        '346627894',
        '513232951',
        '340324473',
        '497008090',
        '509553580',
        '351402946',
        '500187374',
        '477162289',
        '319186589',
        '497003584',
        '273854843',
        '514046914',
        '262938048',
        '501501536',
        '476702931',
        '508046901',
        '497043963',
        '510612348',
        '346783329',
        '346156077',
        '487613813',
        '323569265',
        '350607032',
        '517129704',
        '361558751',
        '499693443',
        '353331287',
        '464245828',
        '524585740',
        '492745784',
        '413094801',
        '486557741',
        '361050751',
        '435112518',
        '501266450',
        '336254360',
        '342476158',
        '519080190',
        '499567150',
        '319705011',
        '345331171',
        '346704465',
        '348215579',
        '449010295',
        '500555215',
        '502719593',
        '509224868',
        '501585884',
        '531542581',
        '503050932',
        '323832798',
        '492750236',
        '341203511',
        '327686152',
        '349363223',
        '249911755',
        '505085769',
        '552555189'
    )
    GROUP BY 1, 2
),

total_genpop AS (
     SELECT
        date_part(year, calendar_date) AS join_field_a,
        date_part(month, calendar_date) AS join_field_b,
        COUNT(DISTINCT guid) AS unique_users
    FROM spectrum_comscore.clickstream_ca
    GROUP BY 1, 2
),

total_output AS (
    SELECT 
    total_intenders.join_field_a,
    total_intenders.join_field_b,
    total_intenders.unique_users AS total_intenders,
    total_converters.unique_users AS total_converters,
    total_genpop.unique_users AS total_genpop
FROM total_genpop
LEFT JOIN total_intenders
    ON total_genpop.join_field_a = total_intenders.join_field_a
    AND total_genpop.join_field_b = total_intenders.join_field_b
LEFT JOIN total_converters
    ON total_genpop.join_field_a = total_converters.join_field_a
    AND total_genpop.join_field_b = total_converters.join_field_b
),


-- *********************************************************************************************
--  INDEX REFERENCE COLUMNS
-- *********************************************************************************************

ref_genpop AS (
    SELECT COUNT(DISTINCT guid) AS unique_users
    FROM spectrum_comscore.clickstream_ca
    WHERE (date_part(year, calendar_date) >= (SELECT value FROM year_lower_bound) AND date_part(year, calendar_date) <= (SELECT value FROM year_upper_bound))
),

ref_intenders AS (
    SELECT COUNT(DISTINCT guid) AS unique_users
    FROM unique_intender_data
    WHERE (date_part(year, calendar_date) >= (SELECT value FROM year_lower_bound) AND date_part(year, calendar_date) <= (SELECT value FROM year_upper_bound))
)

-- *********************************************************************************************
--  OUTPUT
-- *********************************************************************************************

SELECT
    a.join_field_a AS year,
    a.join_field_b AS month,
    a.total_intenders AS total_intenders,
    a.total_converters AS total_converters,
    a.total_genpop AS total_genpop,
    b.unique_users AS ref_genpop,
    c.unique_users AS ref_intenders
FROM total_output AS a
CROSS JOIN ref_genpop AS b
CROSS JOIN ref_intenders AS c

LIMIT 10000;


    /*
     -- *** CONVERTER *** --
     AND
     (
     -- (event_detail LIKE '%shopping-cart%')                                   OR
     -- (event_detail LIKE '%/cart%')                                           OR
     -- (event_detail LIKE '%checkout%')                                        OR
     -- (event_detail LIKE '%shop%' AND event_detail LIKE '%cart%')             OR
     -- (event_detail LIKE '%cart%' AND event_detail LIKE '%shop%')             OR
     
     (event_detail LIKE '%history%' AND event_detail LIKE '%order%')         OR
     (event_detail LIKE '%order%' AND event_detail LIKE '%history%')         OR
     (event_detail LIKE '%recent%' AND event_detail LIKE '%order%')          OR
     (event_detail LIKE '%order%' AND event_detail LIKE '%recent%')          OR
     (event_detail LIKE '%account%' AND event_detail LIKE '%order%')         OR 
     (event_detail LIKE '%order%' AND event_detail LIKE '%account%')         
     )
     */